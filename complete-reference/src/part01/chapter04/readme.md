# Глава 4. Операции

В Java поддерживается 4 типа операций:
* Арифметические;
* Поразрядные;
* Логические;
* Отношения.

Также определены дополнительные операции:
* Сравнения типов `instanceof`;
* Стрелка `->`.

## Арифметические операции

| Операция | Описание                          | Примечание                                  |
| -------- | --------------------------------- | ------------------------------------------- |
| +        | Сложение (а также унарный плюс)   |                                             |
| -        | Вычитание (а также унарный минус) | Унарный минус - смена знака                 |
| *        | Умножение                         |                                             |
| /        | Деление                           |                                             |
| %        | Деление по модулю                 | Возвращает остаток от деления               |
| ++       | Инкремент (приращение на 1)       | Увеличивает значение операнда на 1          |
| +=       | Сложение с присваиванием          | Составная операция сложения с присваиванием |
| -=       | Вычитание с присваиванием         |                                             |
| *=       | Умножение с присваиванием         |                                             |
| /=       | Деление с присваиванием           |                                             |
| %=       | Деление по модулю с присваиванием |                                             |
| --       | Декремент (уменьшение на 1)       |                                             |

Операнды арифметических операций должны иметь **числовой тип** (byte, short, int, long, float, double) или **символьный** (char).

**Составные операции с присваиванием** (переменная операция = выражение) имеют два преимущества:
* Уменьшают объём исходного кода;
* Их реализация в исполняющей системе Java эффективнее реализации эквивалентных длинных форм.

**Операции инкремента ++ и декремента --** имеют две формы:
* **Постфиксная** - операция следует за операндом.
  _Значение сначала извлекается_ для применения в выражении, а потом увеличивается (a++) или уменьшается (a--).
  ```
  x = 100;
  y = x++; // строка равнозначна: y = x;  x = x + 1;
  ```
* **Префиксная** - операция предшествует операнду.
  Значение операнда увеличивается (++a) или уменьшается (--a) _до извлечения значения_ для применения в выражении.
  ```
  x = 100;
  y = ++x; // строка равнозначна: x = x + 1;  y = x;
  ```

## Поразрядные операции

Поразрядные операции воздействуют на отдельные двоичные разряды (биты) операндов.

Их можно выполнять над операндами с **целочисленными типами** данных (byte, short, int, long) и **символьным** (char).

| Операция | Описание                                                 | Примечание                                   |
| -------- | -------------------------------------------------------- |--------------------------------------------- |
| ~        | Поразрядная унарная операция НЕ (NOT)                    |                                              |
| &        | Поразрядная логическая операция И (AND)                  |                                              |
| l        | Поразрядная логическая операция ИЛИ (OR)                 |                                              |
| ^        | Поразрядная логическая операция исключающее ИЛИ (XOR)    |                                              |
| \>>      | Сдвиг вправо                                             | осв. старший бит зап. предыд. знач. ст. бита |
| \>>>     | Сдвиг вправо с заполнением нулями (беззнаковый сдвиг)    | освободившийся старший бит заполняется нулём |
| <<       | Сдвиг влево                                              | значение << количество позиций (бит)         |
| &=       | Поразрядная логическая операция И с присваиванием        |                                              |
| l=       | Поразрядная логическая операция ИЛИ с присваиванием      |                                              |
| ^=       | Поразрядная логическая операция исключающее ИЛИ с присв. |                                              |
| \>>=     | Сдвиг вправо с присваиванием                             |                                              |
| \>>>=    | Сдвиг право с заполнением нулями и присваиванием         |                                              |
| <<=      | Сдвиг влево с присваиванием                              |                                              |

**Целочисленные типы** данных (byte, short, int, long) представлены со знаком (отрицательные и положительные).

**Отрицательные числа в Java представлены в дополнительном коде**.
Самый старший разряд числа (крайний слева) является знаковым (1 = "-").

**Перевод числа в отрицательное и наоборот**:
1. Инвертировать все двоичные разряды исходного значения (изменить 1 на 0, и наоборот 0 на 1);
2. К предыдущему результату прибавить 1.
```
  0 = 00000000
  1 = 00000001
 -1 = 11111110 + 1 = 11111111
 42 = 00101010
-42 = 11010101 + 1 = 11010110
```

* **Поразрядные логические операции**

Результаты выполнения поразрядных логических операций

|    A    |    B    |  A l B  |  A & B  |  A ^ B  |   ~ A   |
| ------- | ------- | ------- | ------- | ------- | ------- |
|    0    |    0    |    0    |    0    |    0    |    1    |
|    1    |    0    |    1    |    0    |    1    |    0    |
|    0    |    1    |    1    |    0    |    1    |    1    |
|    1    |    1    |    1    |    1    |    0    |    0    |

* **Сдвиг**
  * Влево:               <<    Освободившийся младший разряд заполняется нулём.
  * Вправо:             \>>    Освободившийся старший разряд заполняется предыдущим значением старшего разряда.
    Происходит так называемое _расширение знака_.
  * Беззнаковый вправо: \>>>   Освободившийся старший разряд заполняется нулём.
    Беззнаковый сдвиг вправо имеет смысл только для чисел типов int и long (т.к. типы byte и short в выражениях
    автоматически продвигаются к типу int). Чтобы использовать с типами byte, short, то нужно явное преобразование
    (приведение) типов:
    ```
    byte b0 = (byte) 0xF1;
    byte b1 = (byte) (b0 >>> 4); // b1 = 0xFF
    ```

## Операции отношения

Операции отношения, называемые также операциями сравнения, определяют отношение одного операнда к другому.

Результатом выполнения операций отношения является логическое значение (true или false).

| Операция | Описание         |
| -------- | ---------------- |
| ==       | Равно            |
| !=       | Не равно         |
| \>       | Больше           |
| <        | Меньше           |
| \>=      | Больше или равно |
| <=       | Меньше или равно |

Допускается сравнивать значения **любых типов**: целые (byte, short, int, long), с плавающей точкой (float, double),
символы (char), логические (boolean). Но для boolean доступны только операции `==` и `!=`.

## Логические операции

Логические операции выполняются **только** с операндами типа **boolean**.

Т.е. операции оперируют логическими значениями типа boolean, а не двоичными разрядами
(в отличие от поразрядных логических операций).

| Операция | Описание                                                  | Примечание                                    |
| -------- | --------------------------------------------------------- | --------------------------------------------- |
| &        | Логическая операция И                                     |                                               |
| l        | Логическая операция ИЛИ                                   |                                               |
| ^        | Логическая операция исключающее ИЛИ                       |                                               |
| &&       | Укороченная логическая операция И                         | Условная лог. операция И (согл. спецификации) |
| ll       | Укороченная логическая операция ИЛИ                       | Условная лог. операция ИЛИ                    |
| !        | Логическая унарная операция НЕ                            |                                               |
| &=       | Логическая операция И с присваиванием                     |                                               |
| l=       | Логическая операция ИЛИ с присваиванием                   |                                               |
| ^=       | Логическая операция исключающее ИЛИ с присваиванием       |                                               |
| ==       | Равенство                                                 |                                               |
| !=       | Неравенство                                               |                                               |
| ? :      | Тернарная условная операция (если ..., то ..., иначе ...) |                                               |

Результаты выполнения логических операций

|    A    |    B    |  A l B  |  A & B  |  A ^ B  |   ~ A   |
| ------- | ------- | ------- | ------- | ------- | ------- |
|  false  |  false  |  false  |  false  | false   |  true   |
|  true   |  false  |  true   |  false  | true    |  false  |
|  false  |  true   |  true   |  false  | true    |  true   |
|  true   |  true   |  true   |  true   | false   |  false  |

* **Укороченные логические операции && (И) и ll (ИЛИ)**
  * Результат выполнения укороченной логической операции И (A && B) равен false, 
    когда значение операнда A равно false независимо от значения операнда B.
  * Результат выполнения укороченной логической операции ИЛИ (A ll B) равен true, 
    когда значение операнда A равно true независимо от значения операнда B.

* **Операция присваивания** (одиночный знак равенства =)

  переменная **=** выражение;
  
  Переменная и выражение должны иметь совместимый тип данных.
  Допустима цепочка присваивания:
  ```
  int x, y, z;
  x = y = z = 100;
  ```

* **Тернарная операция (? :)** возвращает результат одного из двух выражений (одинакового или совместимого типов).

  выражение1 **?** выражение2 **:** выражение3;
  
  Если выражение1 равно true, то выполняется выражение2 (и возвращается результат выражения2),
  иначе выполняется выражение3 (и возвращается результат выражения3).
  ```
  ratio = denom == 0 ? 0 : num / denom;
  ```

## Предшествование операций

Предшествование операций от высшего к низшему приоритету.
* Операции, находящиеся в одной строке таблицы имеют одинаковый приоритет;
* Операции с двумя операндами имеют порядок вычисления слева направо
  (кроме операции присваивания, которая выполняется справа налево);
* Формально скобки [] и (), а также точка (.) считаются разделителями, но они могут служить и в качестве операций.
  В качестве операций они имеют наивысшее предшествование (приоритет).
  Круглые скобки () повышают приоритет заключённых в них операций. Добавление в код дополнительных круглых скобок
  (избыточных) не снижает производительность программы, но упрощает понимание смысла выражения.

| Приоритет | Операции         |                  |     |     |             |             |                    |
| --------- | ---------------- | ---------------- | --- | --- | ----------- | ----------- | ------------------ |
| Высший    | ++ (постфиксная) | -- (постфиксная) |                                                            |
|           | ++ (префиксная)  | -- (префиксная)  |  ~  |  !  | + (унарная) | - (унарная) | (приведение типов) |
|           | *                | /                |  %                                                         |
|           | +                | -                |                                                            |
|           | \>>              | \>>>             | <<                                                         |
|           | \>               | \>=              | <   |  <= | instanceof                                     |
|           | ==               | !=                                                                            |
|           | &                                                                                                |
|           | ^                                                                                                |
|           | l                                                                                                |
|           | &&                                                                                               |
|           | ll                                                                                               |
|           | ?:                                                                                               |
|           | -> (начиная с JDK 8)                                                                             |
| Низший    | =                | операция =                                                                    |
